{% extends 'base.html' %}

{% block nofollow %}{% end %}
{% block title %}{{ handler.settings['bbs_title'] }} > {{ tagname }}{% end %}

{% block head %}
<link href="/tag/{{ tagname }}/feed" rel="alternate" title="{{ handler.settings['bbs_title'] }}-{{ tagname }}" type="application/atom+xml"/>
{% end %}

{% block nav %}
<li><a href='/'>主页</a></li>
<li><a href='/topics'>主题</a></li>
<li class='active'><a href='/tag'>标签</a></li>
{% end %}

{% block breadcrumb %}
<li><a href="/">{{ handler.settings['bbs_title'] }}</a> <span class="divider">/</span></li>
<li><a href="/tag">标签</a> <span class="divider">/</span></li>
<li class="active" id="tagname">{{ tagname }}</li>
{% end %}

{% block content %}
<section class='box'>
  共{{ posts.count() }}条主题，当前显示{{ (p-1)*limit }} - {{ p*limit < posts.count() and p*limit or posts.count() }}
  <div class="right">
    {% if tagname in user_info['tagmark'] %}
    <a class="label label-important mark" id="mark">取消收藏</a>
    {% else %}
    <a class="label mark" id="mark">收藏</a>
    {% end %}
  </div>
  {{ modules.Post(db=db,posts=posts.skip((p-1)*limit).limit(limit)) }}
  {% if p!=1 %}
  <a href='{{ tagname }}?p={{ p-1 }}' class="btn left">上一页</a>
  {% end %}
  {% if p*limit < posts.count() %}
  <a href='{{ tagname }}?p={{ p+1 }}' class="btn right">下一页</a>
  {% end %}
</section>
<!-- 给蜘蛛爬 -->
<div style="display: none;">
{% for x in range(1,posts.count()/limit+1) %}
<a href='{{ tagname }}?p={{ x }}'>第{{ x }}页</a>
{% end %}
</div>

{% end %}
{% block foot %}{{ xsrf_form_html() }}<script src='{{ static_url("js/marktag.js") }}' type="text/javascript"></script>{% end %}