{% if p %}
共{{ count }}条主题，当前显示{{ (p-1)*limit+1 }} - {{ p*limit < count and p*limit or count }}
<!-- 给蜘蛛爬 -->
<div class="hide">
    {% for x in range(1,count/limit+1) %}
    <a href='{{ "".join(url_escape(request.uri).split("?")[0:-1]) }}?p={{ x }}'>第{{ x }}页</a>
    {% end %}
</div>
{% end %}

<table class='item-list'>
    <tbody>
    {% for post in posts %}
    <tr>
        {% set replyuser = getuser(post["author"],db,mc) %}
        <td class='avatar'>
            <a href="/user/{{ post['author'] }}"><img src='http://gravatar.com/avatar/{{ replyuser["hashed_email"] }}?s=48' /></a>
        </td>
        <td>
            <h3>
                <a href="/topics/{{ post['_id'] }}">{{ post['title'] }}</a>
            </h3>

            <span class='tags'>
            {% for tag in post['tags'] %}
            <a href="/tag/{{ tag }}">{{ tag }}</a>
            {% end %}
            </span>
            <a href="/user/{{ post['author'] }}" rel="popover" title="{{ post['author'] }}<div class='right'>{{ replyuser.setdefault('location','') }}</div>" data-content="{{ replyuser.setdefault('words','') }}">{{ post['author'] }}</a>
            于<time datetime="{{ time_span(post['posttime']) }}" >{{ time_span(post['posttime']) }}</time>
            {% if len(post['comments']) > 0 %}
            {% set replyuser = getuser(post['comments'][-1]['author'],db,mc) %}
            ,<a href="/user/{{ replyuser['username'] }}" rel="popover" title="{{ replyuser['username'] }}<div class='right'>{{ replyuser.setdefault('location','') }}</div>" data-content="{{ replyuser.setdefault('words','') }}">{{ replyuser['username'] }}</a>
            回复于<time datetime="{{ time_span(post['comments'][-1]['posttime']) }}" >{{ time_span(post['comments'][-1]['posttime']) }}</time>
            {% end %}

        </td>
        <td class='reply-count last'>
            <a href="/topics/{{ post['_id'] }}#reply-{{ len(post['comments']) }}">{{ len(post['comments']) }}</a>
        </td>
    </tr>
    {% end %}
    <script src='{{ static_url("js/popover-run.js") }}'></script>\
    <script src='{{ static_url("js/timeago.js") }}'></script>
    </tbody>
</table>

{% if p %}
{% if p!=1 %}
<a href='{{ "".join(url_escape(request.uri).split("?")[0:-1]) }}?p={{ p-1 }}' class="btn left">上一页</a>
{% end %}
{% if p*limit < count %}
<a href='{{ "".join(url_escape(request.uri).split("?")[0:-1]) }}?p={{ p+1 }}' class="btn right">下一页</a>
{% end %}
{% end %}