{% extends 'base.html' %}

{% block title %}注册 -- {{ handler.settings['bbs_title'] }}{% end %}

{% block breadcrumb %}
<li><a href="/">{{ handler.settings['bbs_title'] }}</a> <span class="divider">/</span></li>
<li class="active">注册</li>
{% end %}

{% block body %}
<div class='container'>
  <div class='row'>
    <div class='box container'>
      <form class='form-horizontal well span7 offset2'>
      {{ xsrf_form_html() }}
        <fieldset>
          <header><h2>注册</h2></header>
          <div id="username-g" class="control-group">
            <label class="control-label" for="username">用户名</label>
            <div class="controls">
              <input type="text" id="username">
              <span id="username-t" class="help-inline">你的输入不大正确哦</span>
              <p class="help-block">用户名将是你以后在论坛的唯一标识，可以使用30个字符以下的中英文.</p>
            </div>
          </div>
          <div id="email-g" class="control-group">
            <label class="control-label" for="email">E-mail</label>
            <div class="controls">
              <input type="text" id="email">
              <span id="email-t" class="help-inline">请输入有效的邮箱地址</span>
            </div>
          </div>
          <div id="password-g" class="control-group">
            <label class="control-label" for="password">密码</label>
            <div class="controls">
              <input type="password" id="password">
              <span id="password-t" class="help-inline">请使用6位以上的密码</span>
            </div>
          </div>
          <div id="password-ag-g" class="control-group">
            <label class="control-label" for="password-ag">重复密码</label>
            <div class="controls">
              <input type="password" id="password-ag">
              <span id="password-ag-t" class="help-inline">请重复上面的密码</span>
            </div>
          </div>
          <div class="form-actions">
            <button id='submit' class='btn btn-primary'>注册</button>
          </div>
        </fieldset>
      </form>
    </div>
  </div>
</div>
<script type="text/javascript">
  $("#username").blur(function(){
    checkInput("#username",(!$(this).val() || !$(this).val().match(/.{1,30}$/)));
  });
  $("#email").blur(function(){
    checkInput("#email",(!$(this).val() || !$(this).val().match(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/)));
  });
  $("#password").blur(function(){
    checkInput("#password",(!$(this).val() || !$(this).val().match(/.{6,}$/)));
  });
  $("#password-ag").blur(function(){
    checkInput("#password-ag",($(this).val()!=$("#password").val()));
  });
  $("#username-t").hide();
  $("#email-t").hide();
  $("#password-t").hide();
  $("#password-ag-t").hide();
  $("#submit").click(function(){
    readySubmit=true;
    $("#username").blur();
    $("#email").blur();
    $("#password").blur();
    $("#password-ag").blur();
    if(!readySubmit)
      return false;
    $.post("/signup",{_xsrf:$("input[name='_xsrf']").val(),
                      username:$("#username").val(),
                      email:$("#email").val(),
                      password:$("#password").val()},
    function(data){
      alert(data.message);
      if(data.status=="success")
        location.href="/";
    },"json");
    return false;
  });
</script>
{% end %}


