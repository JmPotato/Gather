{% extends 'base.html' %}

{% block title %}{{ handler.settings['bbs_title'] }} > {{ post['title'] }}{% end %}

{% block head %}
<script src='{{ static_url("js/wmd/wmd.js") }}' type="text/javascript"></script>
<link rel='stylesheet' href='{{ static_url("postview.css") }}' type='text/css'/>
<script src='{{ static_url("js/highlight.pack.js") }}' type="text/javascript"></script>
<link rel='stylesheet' href='{{ static_url("highlight.css") }}' type='text/css'/>
<script type="text/javascript">
    commentNum={{ len(post['comments']) }};
    postID="{{ post['_id'] }}";
</script>
{% end %}

{% block breadcrumb %}
<li><a href="/">{{ handler.settings['bbs_title'] }}</a> <span class="divider">/</span></li>
<li class="active">{{ post['title'] }}</li>
{% end %}

{% block body %}
<div class='container'>
  <div class='row'>
    <div class='span9'>
      <section class='box'>
        <article id='topic-379'>
          <header>
            <table class='clear-table'>
              <tbody>
                <tr>
                  <td class='avatar'>
                    <img src='http://gravatar.com/avatar/{{ md5(db.users.find_one({"username":post["author"]})["email"]).hexdigest() }}.png?r=G&amp;s=72' /></a>
                  </td>
                  <td>
                    <h1>{{ post['title'] }}</h1>
                    {% if len(post['tags']) > 0 %}
                    <span class='tags'>
                      {% for tag in post['tags'] %}
                      <a href="/tag/{{ tag }}">{{ tag }}</a>
                      {% end %}
                    </span>
                    {% end %}
                    <a href="/user/{{ post['author'] }}">{{ post['author'] }}</a>创建于{{ time_span(post['posttime']) }}
                  </td>
                </tr>
              </tbody>
            </table>
          </header>
          {{ post['content'] }}
          <footer>
            <div class="right">
              <a href="#;" onclick="window.open('https://twitter.com/share?url='+window.location.href+'&related=v2ex&hashtags=share&text={{ post["title"] }}', '_blank', 'width=550,height=370'); recordOutboundLink(this, 'Share', 'twitter.com');" class="label">Tweet</a>
              <a href="javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://www.douban.com/recommend/?url='+e(d.location.href)+'&title='+e(d.title)+'&sel='+e(s)+'&v=1',x=function(){if(!window.open(r,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()" class="label">Douban</a>
              <a href="#;" onclick="window.open('http://service.weibo.com/share/share.php?url='+window.location.href+'&title{{ post["title"] }}', '_blank', 'width=550,height=370'); recordOutboundLink(this, 'Share', 'weibo.com');" class="label">Weibo</a>
              {% if current_user in admin_list %}
                <a href="/admin/post/kill/{{ post['_id'] }}" class='label label-important'>和谐</a>
              {% end %}
            </div>
            <!-- 打算放些用户打分什么的-->
          </footer>
        </article>
      </section>
      <section class='box'>
        <table id="comments" class='table item-list'>

        </table>
        <button id='more' class='btn btn-info'>官人，论家还要嘛。</button>
      </section>
      <section class='box'>
        {{ xsrf_form_html() }}
        <div id='markdown-g' class='control-group'>
          <div class='controls'>
            <textarea class="span8" style="height:200px;" id='markdown' name='markdown'></textarea>
            <textarea style="display:none;" name="html" id="html" class="wmd-output"></textarea>
          </div>
          <div id="markdown-t" class="box controls">
            <span class="help-inline">起码也要输入几个字嘛~</span>
          </div>
        </div>
        <div class="well">
          <h4>预览(焦点离开输入框后刷新)</h4>
          <div id="preview"></div>
        </div>
        <button id='submit' class='btn btn-primary'>很好，我要发表</button>
      </section>
    </div>
    <div class='span3'>
      <section class="box">
        <header>
          <h3>相关主题</h3>
        </header>
        <ul>
          {% if len(likely) > 0%}
          {% for x in likely %}
          <li><a href="/topics/{{ x['_id'] }}">{{ x['title'] }}</a></li>
          {% end %}
          {% else %}
          没有相关的主题。。
          {% end %}
        </ul>
        <footer>
          {% if current_user %}
          <button id='newPost' class='btn btn-success'>我也要发帖</button>
          {% else %}
          <p>少年，连账号都没有怎么行呢？</p>
          还不快快 <a href="/signup" class='btn btn-warning'>注册</a>或者<a href="/login" class='btn'>登录</a></li>
          {% end %}
        </footer>
      </section>
    </div>
  </div>
</div>
<script src='{{ static_url("js/postview.js") }}' type="text/javascript"></script>
{% end %}


