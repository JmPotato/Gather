var Markdown;typeof exports=="object"&&typeof require=="function"?Markdown=exports:Markdown={},function(){function a(a){return a}function b(a){return!1}function c(){}function d(){}c.prototype={chain:function(b,c){var d=this[b];if(!d)throw new Error("unknown hook "+b);d===a?this[b]=c:this[b]=function(a){return c(d(a))}},set:function(a,b){if(!this[a])throw new Error("unknown hook "+a);this[a]=b},addNoop:function(b){this[b]=a},addFalse:function(a){this[a]=b}},Markdown.HookCollection=c,d.prototype={set:function(a,b){this["s_"+a]=b},get:function(a){return this["s_"+a]}},Markdown.Converter=function(){function h(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,c,d,f,g,h){return c=c.toLowerCase(),b.set(c,D(d)),g?f:(h&&e.set(c,h.replace(/"/g,"&quot;")),"")}),a}function i(a){var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,j),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,j),a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,j),a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,j),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,j),a}function j(a,b){var c=b;return c=c.replace(/^\n+/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(f.push(c)-1)+"K\n\n",c}function k(a,b){a=s(a);var c="<hr />\n";return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,c),a=t(a),a=w(a),a=B(a),a=i(a),a=C(a,b),a}function l(a){return a=y(a),a=m(a),a=E(a),a=p(a),a=n(a),a=F(a),a=a.replace(/~P/g,"://"),a=D(a),a=A(a),a=a.replace(/  +\n/g," <br>\n"),a}function m(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=L(b,a.charAt(1)=="!"?"\\`*_/":"\\`*_"),b}),a}function n(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,o),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,o),a}function o(a,c,d,f,g,h,i,j){j==undefined&&(j="");var k=c,l=d.replace(/:\/\//g,"~P"),m=f.toLowerCase(),n=g,o=j;if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)!=undefined)n=b.get(m),e.get(m)!=undefined&&(o=e.get(m));else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}n=K(n),n=L(n,"*_");var p='<a href="'+n+'"';return o!=""&&(o=q(o),o=L(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>",p}function p(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,r),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,r),a}function q(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function r(a,c,d,f,g,h,i,j){var k=c,l=d,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)==undefined)return k;n=b.get(m),e.get(m)!=undefined&&(o=e.get(m))}l=L(q(l),"*_[]()"),n=L(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=q(o),o=L(o,"*_"),p+=' title="'+o+'"',p+=" />",p}function s(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+l(b)+"</h1>\n\n"}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+l(b)+"</h2>\n\n"}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return"<h"+d+">"+l(c)+"</h"+d+">\n\n"}),a}function t(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return g?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol",f=v(d,e);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",h=v(f,g);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a}function v(a,b){g++,a=a.replace(/\n{2,}$/,"\n"),a+="~0";var c=u[b],d=new RegExp("(^[ \\t]*)("+c+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+c+")[ \\t]+))","gm"),e=!1;return a=a.replace(d,function(a,b,c,d){var f=d,g=b,h=/\n\n$/.test(f),i=h||f.search(/\n{2,}/)>-1;return i||e?f=k(H(f),!0):(f=t(H(f)),f=f.replace(/\n$/,""),f=l(f)),e=h,"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),g--,a}function w(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=z(H(d)),d=I(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>","\n\n"+d+"\n\n"+e}),a=a.replace(/~0/,""),a}function x(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(f.push(a)-1)+"K\n\n"}function y(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=z(f),f=f.replace(/:\/\//g,"~P"),b+"<code>"+f+"</code>"}),a}function z(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=L(a,"*_{}[]\\",!1),a}function A(a){return a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4"),a}function B(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=k(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /mg,"~0"),c=c.replace(/~0/g,""),c}),x("<blockquote>\n"+c+"\n</blockquote>")}),a}function C(a,b){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,g=c.length;for(var h=0;h<g;h++){var i=c[h];e.test(i)?d.push(i):/\S/.test(i)&&(i=l(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",d.push(i))}if(!b){g=d.length;for(var h=0;h<g;h++){var j=!0;while(j)j=!1,d[h]=d[h].replace(/~K(\d+)K/g,function(a,b){return j=!0,f[b]})}}return d.join("\n\n")}function D(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a}function E(a){return a=a.replace(/\\(\\)/g,M),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,M),a}function F(b){b=b.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var c=function(b,c){return'<a href="'+c+'">'+a.plainLinkText(c)+"</a>"};return b=b.replace(/<((https?|ftp):[^'">\s]+)>/gi,c),b}function G(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)}),a}function H(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a}function I(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){return a==="\n"?(c=e+1,a):(d=(e-c)%4,c=e+1,b[d])})}function K(a){if(!a)return"";var b=a.length;return a.replace(J,function(c,d){if(c=="~D")return"%24";if(c==":")if(d==b-1||/[0-9\/]/.test(a.charAt(d+1)))return":";return"%"+c.charCodeAt(0).toString(16)})}function L(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,M),a}function M(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}var a=this.hooks=new c;a.addNoop("plainLinkText"),a.addNoop("preConversion"),a.addNoop("postConversion");var b,e,f,g;this.makeHtml=function(c){if(b)throw new Error("Recursive call to converter.makeHtml");return b=new d,e=new d,f=[],g=0,c=a.preConversion(c),c=c.replace(/~/g,"~T"),c=c.replace(/\$/g,"~D"),c=c.replace(/\r\n/g,"\n"),c=c.replace(/\r/g,"\n"),c="\n\n"+c+"\n\n",c=I(c),c=c.replace(/^[ \t]+$/mg,""),c=i(c),c=h(c),c=k(c),c=G(c),c=c.replace(/~D/g,"$$"),c=c.replace(/~T/g,"~"),c=a.postConversion(c),f=e=b=null,c};var u={ol:"\\d+[.]",ul:"[*+-]"},J=/(?:["'*()[\]:]|~D)/g}}();(function(){function c(a){return a.replace(/<[^>]*>?/gi,g)}function g(a){return a.match(d)||a.match(e)||a.match(f)?a:""}function h(a){if(a=="")return"";var b=/<\/?\w+[^>]*(\s|$|>)/g,c=a.toLowerCase().match(b),d=(c||[]).length;if(d==0)return a;var e,f,g="<p><img><br><li><hr>",h,i=[],j=[],k=!1;for(var l=0;l<d;l++){e=c[l].replace(/<\/?(\w+).*/,"$1");if(i[l]||g.search("<"+e+">")>-1)continue;f=c[l],h=-1;if(!/^<\//.test(f))for(var m=l+1;m<d;m++)if(!i[m]&&c[m]=="</"+e+">"){h=m;break}h==-1?k=j[l]=!0:i[h]=!0}if(!k)return a;var l=0;return a=a.replace(b,function(a){var b=j[l]?"":a;return l++,b}),a}var a,b;typeof exports=="object"&&typeof require=="function"?(a=exports,b=require("./Markdown.Converter").Converter):(a=window.Markdown,b=a.Converter),a.getSanitizingConverter=function(){var a=new b;return a.hooks.chain("postConversion",c),a.hooks.chain("postConversion",h),a};var d=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,e=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,f=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i})();(function(a){var b=function(b){this._input=a(b),this.tag_editor=a('<div class="tag-editor"></div>'),this.tag_preview=a('<span class="tag-preview"></span>'),this.tag_input=a('<input class="tag-input" type="text" placeholder="请输入标签"/>'),this.tag_editor.append(this.tag_preview).append(this.tag_input),this.tag_editor.insertBefore(this._input),this._input.hide(),this.tags=this._input.val().split(/[,\s]+/).filter(function(a){return a!==""}),this.draw_preview(),this.typeahead(),this.lisent()};b.prototype={typeahead:function(){this.tag_input.typeahead({source:this._input.data("suggest"),items:5});var a=this.tag_input.data("typeahead"),b=a.select,c=this;a.select=function(){b.call(this),c.extract_tags()}},lisent:function(){var b=this;this.tag_editor.click(function(){b.focus_input()}),this.tag_input.keyup(function(a){b.keyup_handle(a)}),this.tag_input.keydown(function(a){b.keydown_handle(a)}),this.tag_input.focus(function(){b.tag_editor.addClass("focus")}),this.tag_input.focusout(function(){b.tag_editor.removeClass("focus")}),a("#submit").click(function(){b.extract_tags()})},focus_input:function(){this.tag_input.focus()},keyup_handle:function(a){switch(a.which){case 188:case 32:/[,\s]$/.test(this.tag_input.val())&&this.extract_tags()}},extract_tags:function(){var b=this.tag_input.val(),c=b.split(/[,\s]+/).filter(function(a){return a!==""});if(c.length>0){var d=this;this.tag_input.val(""),this.tags=a.merge(this.tags,c.filter(function(a){return d.tags.indexOf(a)===-1})),this.draw_preview(),this.update_input()}},keydown_handle:function(a){a.which==8&&this.tag_input.val()===""&&this.tags.length!==0&&(a.preventDefault(),this.tag_input.val(this.tags.pop()),this.draw_preview(),this.update_input())},draw_preview:function(){this.tag_preview.html("");var b=this;a.each(this.tags,function(){var c=a('<span class="tag"><span class="content">'+this+'</span><span class="delete">x</span></span>');c.find("span.delete").click(function(){b.delete_tag(a(this).siblings(".content").text())}),b.tag_preview.append(c)})},update_input:function(){this._input.val(this.tags.join(" ")).change()},delete_tag:function(a){this.tags=this.tags.filter(function(b){return b!==a}),this.draw_preview(),this.update_input()}},a.fn.tagEditor=function(){return this.each(function(){new b(this)})}})(jQuery);(function(a){function b(a){if("selection"in document){a.focus();var b=0,c=0,d,e,f,g,h,i=a;e=document.selection.createRange(),pos=0,e&&e.parentElement()==i&&(d=i.value.replace(/\r\n/g,"\n"),g=d.length,f=i.createTextRange(),f.moveToBookmark(e.getBookmark()),h=i.createTextRange(),h.collapse(!1),f.compareEndPoints("StartToEnd",h)>-1?b=c=g:(b=-f.moveStart("character",-g),c=-f.moveEnd("character",-g)))}else b=a.selectionStart;return b}function c(a,b){"selection"in document?(range=a.createTextRange(),range.move("character",b),range.select()):a.setSelectionRange(b,b)}a.fn.caretPos=function(a){var d=this[0];return a?c(d,a):b(d)}})(jQuery);(function(a){function b(b,c){var e=[];return d(b,c),a.map(b,function(b,d){var f=a.isPlainObject(b)?b[c]:b;if(a.inArray(f,e)<0)return e.push(f),b})}function c(b){return!b||a.isPlainObject(b)&&a.isEmptyObject(b)||a.isArray(b)&&b.length==0||b instanceof a&&b.length==0||b===undefined}function d(){if(!At.getOpt("debug")||a.browser.msie)return;console.log(arguments)}function e(b){return opt={},a.isFunction(b)?opt.callback=b:opt=b,a.extend({cache:!0,debug:!1,limit:5,tpl:DEFAULT_TPL},opt)}Mirror=function(a){this.init(a)},Mirror.prototype={$mirror:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(b){$mirror=a("<div></div>");var c={opacity:0,position:"absolute",left:0,top:0,zIndex:-2e4,"word-wrap":"break-word","white-space":"pre-wrap"};a.each(this.css,function(a,d){c[d]=b.css(d)}),$mirror.css(c),a("body").append($mirror),this.$mirror=$mirror},setContent:function(a){this.$mirror.html(a)},getFlagPos:function(){return this.$mirror.find("span#flag").position()},height:function(){return this.$mirror.height()}},At={keyword:{text:"",start:0,stop:0},_cache:{},$inputor:null,inputor_keys:[],lenght:0,pos:0,flags:{},theflag:null,options:{},searchWord:function(){var a=/data-keyname=['?]\$\{(\w+)\}/g.exec(this.getOpt("tpl"));return c(a)?null:a[1]},getOpt:function(a){var b=this.theflag;try{return this.options[b][a]}catch(c){return null}},offset:function(){function b(b){return b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/`/g,"&#96;").replace(/"/g,"&quot;"),a.browser.msie&&(rep_str=parseInt(a.browser.version)<8?"&nbsp;":"<span> </span>",b=b.replace(/ /g,rep_str)),b.replace(/\r\n|\r|\n/g,"<br />")}return $inputor=this.$inputor,mirror=$inputor.data("mirror"),c(mirror)&&(mirror=new Mirror($inputor),$inputor.data("mirror",mirror)),text=$inputor.val(),start_range=text.slice(0,this.pos-1),end_range=text.slice(this.pos+1),html="<span>"+b(start_range)+"</span>",html+="<span id='flag'>@</span>",html+="<span>"+b(end_range)+"</span>",mirror.setContent(html),offset=$inputor.offset(),at_pos=mirror.getFlagPos(),line_height=$inputor.css("line-height"),line_height=isNaN(line_height)?20:line_height,y=offset.top+at_pos.top+line_height-$inputor.scrollTop(),x=offset.left+at_pos.left-$inputor.scrollLeft(),{top:y,left:x}},cache:function(a,b){return this.getOpt("cache")?(d("cacheing",a,b),b&&(this._cache[a]=b),this._cache[a]):null},getKeyname:function(){return $inputor=this.$inputor,text=$inputor.val(),caret_pos=$inputor.caretPos(),subtext=text.slice(0,caret_pos),self=this,matched=null,a.each(this.options,function(a){regexp=new RegExp(a+"(\\w+)$|"+a+"([^\\x00-\\xff]+)$","gi"),matched=regexp.exec(subtext);if(!c(matched))return self.theflag=a,!1}),key=null,d("matched",matched),matched&&(word=matched[1]).length<20?(start=caret_pos-word.length,end=start+word.length,this.pos=start,key={text:word,start:start,end:end}):this.view.hide(),this.keyword=key,d("getKeyname",key),key},onkeydown:function(b){view=this.view;if(!view.watching())return!0;last_idx=view.items.length-1;var c=!1;switch(b.keyCode){case 27:this.choose();break;case 38:a(view.id+" ul li.cur").removeClass("cur"),view.cur_li_idx--,view.cur_li_idx<0&&(view.cur_li_idx=last_idx),a(view.id+" li:eq("+view.cur_li_idx+")").addClass("cur");break;case 40:a(view.id+" ul li.cur").removeClass("cur"),view.cur_li_idx++,view.cur_li_idx>last_idx&&(view.cur_li_idx=0),a(view.id+" li:eq("+view.cur_li_idx+")").addClass("cur");break;case 9:case 13:a(view.id+" ul li.cur").removeClass("cur"),$cur_li=a(view.id+" li:eq("+view.cur_li_idx+")"),this.choose($cur_li);break;default:c=!0}return c},replaceStr:function(a){key=this.keyword,source=this.$inputor.val(),start_str=source.slice(0,key.start),text=start_str+a+source.slice(key.end),this.$inputor.val(text),this.$inputor.caretPos(start_str.length+a.length)},choose:function(a){str=c(a)?this.keyword.text+" ":a.attr("data-keyname")+" ",this.replaceStr(str),this.view.hide()},reg:function(b){$inputor=a(b),key=$inputor.data("@reg-key");if(a.inArray(key,this.inputor_keys)>=0)return null;d("reg",b,key),key="@-"+a.now(),$inputor.data("@reg-key",key),this.inputor_keys.push(key);var c=this;return $inputor.bind("keydown",function(a){return c.onkeydown(a)}).scroll(function(a){c.view.hide()}).blur(function(a){c.view.timeout_id=setTimeout("At.view.hide()",100)}),key},watch:function(b){this.$inputor=a(b),key=this.getKeyname();if(!key)return!1;c(names=this.cache(this.keyword.text))?c(names=this.watchWithData(key))?a.isFunction(callback=this.getOpt("callback"))?(d("callbacking",callback),callback(At)):this.view.hide():(d("statis data",names),this.view.load(names,!1)):(d("cache data",names),this.view.load(names,!1))},watchWithData:function(b){data=this.getOpt("data"),d("watchWithData",data);var c=null,e=this;return a.isArray(data)&&data.length!=0&&(c=a.map(data,function(c,d){var f=a.isPlainObject(c)?c[e.searchWord()]:c;return match=f.match(new RegExp(b.text,"i")),match?c:null})),d("watch with data.item",c),c}},At.view={cur_li_idx:0,timeout_id:null,id:"#at-view",items:[],watching:function(){return a(this.id).is(":visible")},evalTpl:function(a,b){if(c(a))return;return el=a.replace(/\$\{([^\}]*)\}/g,function(a,c,d){return b[c]}),d("evalTpl",el),el},onLoaded:function(b){b.find("li").live("click",function(b){At.choose(a(this))}),b.mousemove(function(b){b.target.tagName=="LI"&&(a(this).find("li.cur").removeClass("cur"),a(b.target).addClass("cur"),At.cur_li_idx=a(this).find("li").index(b.target))})},rePosition:function(a){a.offset(At.offset())},show:function(){this.watching()||($view=a(this.id).show()),this.rePosition($view)},hide:function(){if(!this.watching())return;this.cur_li_idx=0,a(this.id).hide()},load:function(b,d){return c(a(this.id))&&(tpl="<div id='"+this.id.slice(1)+"' class='at-view'><span id='title'>@who?</span><ul id='"+this.id.slice(1)+"-ul'></ul></div>",a("body").append(tpl),this.onLoaded(a(this.id))),this.update(b,d)},clear:function(b){b==1&&(this._cache={}),this.items=[],a(this.id).find("ul").empty()},update:function(c,d){if(!a.isArray(c))return!1;d!=0&&At.cache(At.keyword.text,c),$ul=a(this.id).find("ul"),this.clear(),a.merge(this.items,c);var e=At.getOpt("tpl"),f=this,c=b(c,At.searchWord());a.each(c.splice(0,At.getOpt("limit")),function(b,c){a.isPlainObject(c)||(c={id:b,name:c},e=DEFAULT_TPL),$ul.append(f.evalTpl(e,c))}),this.show(),$ul.find("li:eq(0)").addClass("cur")}},DEFAULT_TPL="<li id='${id}' data-keyname='${name}'>${name}</li>",a.fn.atWho=function(b,c){return At.options[b]=e(c),d("options",At.options),this.filter("textarea, input").each(function(){if(!At.reg(this))return;a(this).bind("keyup",function(a){var b=a.keyCode==40||a.keyCode==38;watch=!At.view.watching()||!b,watch&&At.watch(this)}).mouseup(function(a){At.watch(this)})})}})(window.jQuery);(function(a){var b=function(b){var c={action:"/upload",iframeId:"uploader-iframe",buttonId:"uploader-button",buttonText:"Upload",formExtra:"",callback:null};b&&a.extend(c,b);var d=a(this);d.after('<a id="'+c.buttonId+'" href="#">'+c.buttonText+"</a>");var e=document.createElement("form");e.method="post",e.enctype="multipart/form-data",e.target="iframeUploader",e.action=c.action,a(e).append(a(this)).append(c.formExtra).css({position:"absolute",left:"-99999px"}).appendTo("body"),a("#"+c.buttonId).click(function(){return d.click(),!1}),d.change(function(){a("body").append('<iframe id="'+c.iframeID+'" name="iframeUploader" style="display:none"></iframe>');var b=a("#"+c.iframeID).load(function(){var d=b.contents().find("body").html();c.callback&&c.callback(d),a(b).unbind("load"),b.remove()});e.submit()})};a.fn.uploader=b})(jQuery);